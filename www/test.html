<!doctype html>
<html>
<head>
    <!-- Replace "localhost" with real IP address of controller, if default port changed, correct it too -->
    <!-- <script type="text/javascript" src="http://localhost:8082/socket.io/socket.io.js"></script> -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    <script type="text/javascript" src="conn.js"></script>
</head>
<body>

<!--
    Check the browser console!
-->

<script type="text/javascript">
    var namespace  = 'homeOverview.0';
    // var connectionLink = 'http://192.168.90.1:8082';
    var connectionLink = location.origin;
    servConn.namespace   = namespace;
    servConn._useStorage = false;

    var states = [];
    servConn.init({
        name:          namespace,  // optional - default 'vis.0'
        connLink:      connectionLink,  // optional URL of the socket.io adapter
        socketSession: ''           // optional - used by authentication
    }, {
        onConnChange: function (isConnected) {
            if (isConnected) {
                console.log('connected');
                servConn.getStates(function (err, _states) {
                    var count = 0;
                    for (var id in _states) {
                        count++;
                        if(id == "javascript.0.test_table2"){
                            console.log('NEW VALUE of ' + id + ': ' + JSON.stringify(_states[id]));
                        }
                    }
                    console.log('Received ' + count + ' states.');
                    states = _states;
                });
            } else {
                console.log('disconnected');
            }
        },
        onRefresh: function () {
            window.location.reload();
        },
        onUpdate: function (id, state) {
            setTimeout(function () {
                if(id == "javascript.0.test_table2"){
                    console.log('NEW VALUE of ' + id + ': ' + JSON.stringify(state));
                }
                states[id] = state;
            }, 0);
        },
        onError: function (err) {
            window.alert(_('Cannot execute %s for %s, because of insufficient permissions', err.command, err.arg), _('Insufficient permissions'), 'alert', 600);
        }
    });
</script>
</body>